# 编译问题修复说明

## 问题描述
项目无法编译通过，出现以下错误：
1. 链接器错误：`undefined reference to symbol '_ZN3pcl9VoxelGridINS_8PointXYZEE11applyFilterERNS_10PointCloudIS1_EE'`
2. vtable未定义错误：`undefined reference to vtable for algorithm_pipeline::algorithms::Downsample`

## 根本原因分析
1. **PCL filters库缺失**：主项目CMakeLists.txt中没有包含PCL的filters组件，而代码中使用了VoxelGrid过滤器
2. **downsample库链接问题**：主项目没有正确链接downsample子模块
3. **符号可见性问题**：downsample库的符号可见性设置为hidden，导致vtable符号无法被外部访问

## 修复内容

### 1. 修改主项目CMakeLists.txt

#### 添加PCL filters和segmentation组件
```cmake
# 修改前
find_package(PCL REQUIRED COMPONENTS io visualization common)

# 修改后  
find_package(PCL REQUIRED COMPONENTS io visualization common filters segmentation)
```

#### 添加downsample库的包含路径
```cmake
# 现代 CMake 风格绑定 include 路径
target_include_directories(qt_pcl_viewer
    PRIVATE
        include
        downsample/include  # 新增
        ${PCL_INCLUDE_DIRS}
        ${VTK_INCLUDE_DIRS}
)
```

#### 链接必要的库
```cmake
# 链接库
target_link_libraries(qt_pcl_viewer
    PRIVATE
        Qt5::Widgets
        ${PCL_LIBRARIES}
        ${VTK_LIBRARIES}
        pcl_segmentation
        pcl_common
        pcl_search
        pcl_kdtree
        pcl_filters      # 新增
        downsample       # 新增
)
```

### 2. 修改downsample/CMakeLists.txt

#### 修复符号可见性问题
```cmake
# 修改前
set_target_properties(${PROJECT_NAME} PROPERTIES
    CXX_VISIBILITY_PRESET hidden
    VISIBILITY_INLINES_HIDDEN ON
)

# 修改后
set_target_properties(${PROJECT_NAME} PROPERTIES
    CXX_VISIBILITY_PRESET default
    VISIBILITY_INLINES_HIDDEN OFF
)
```

## 修复结果
- ✅ 编译成功通过
- ✅ 生成可执行文件 `build/qt_pcl_viewer` (1.8MB)
- ✅ 所有PCL相关的符号正确链接
- ✅ downsample库的vtable符号正确导出

## 技术说明
1. **PCL组件依赖**：VoxelGrid类属于PCL的filters模块，需要显式链接pcl_filters库
2. **符号可见性**：C++共享库默认的hidden可见性会隐藏类的vtable，导致链接时找不到虚函数表
3. **CMake现代化**：使用target_*系列命令而不是全局变量，提供更好的依赖管理

## 验证方法
```bash
cd build
make clean
make
ls -la qt_pcl_viewer  # 确认可执行文件生成
```

编译修复完成，项目现在可以正常构建。
